#include <SoftwareSerial.h>

/*
Written by Liam Bindle
USST, 2015

Pin2:  EN
Pin5:  M1 IN1
Pin6:  M1 IN2

Pin9:  M2 IN1
Pin10: M2 IN2



*/

#define m1_in1 5
#define m1_in2 6 
#define m2_in1 9
#define m2_in2 10
#define enable 2
#define m1_fb A0
#define m2_fb A1

void setup() {
  Serial.begin(9600);
  pinMode(enable,OUTPUT);
  digitalWrite(enable,HIGH);

}
boolean setDutyCycle(int);
boolean setMotorSpeed(int, int);


void loop() {
  // put your main code here, to run repeatedly:

}


boolean setMotorSpeed(int val, int coeff){
  //coeff is to set the rate at which it acclerates 
  int absVal = val;
  if(val<0){ 
    absVal = -1*val;
  }
  int upperBound = map(absVal, 0,100,0,256);
  
   for(int t = 0; t*t/coeff <= upperBound ; t ++){
       setDutyCycle(t*t/coeff); 
   }
} 


boolean setDutyCycle(int val){
  if(val>0){
    //go forwards
    if(val<256){
      analogWrite(m1_in1,val);
      analogWrite(m1_in2,0);
    }
    else{ //if val > 255
      analogWrite(m1_in1,255);
      analogWrite(m1_in2,0);
    }
  }
  else if(val<0){
     //go backwards
    if(val > -256){
      analogWrite(m1_in1,0);
      analogWrite(m1_in2,val); 
      
      return true;
    }
    else{
      analogWrite(m1_in1,0);
      analogWrite(m1_in2,255); 
      
      return true;      
    }
  }
  else{ //if val < -255
     analogWrite(m1_in1,0);
     
     return true;
  }
  
  return false;
}

